# 需求文档：基于 Multiling IOC 标准的鸟类照片虚拟索引系统

## 1. 项目愿景
为生态摄影师和科研人员提供一个非侵入式的数字资产管理工具。系统通过内置的 Multiling IOC World Bird List (v15.1) 权威数据库，自动识别并组织用户硬盘中以“学名”命名的照片，建立一套严谨的生物分类学虚拟索引，指引用户快速定位原文件。

## 2. 核心逻辑与原则
- **规范化驱动**：不再支持用户自定义分类，完全以内嵌的 Multiling IOC 列表为准。
- **零文件操作**：默认不对用户的物理文件进行移动、复制、改名或删除，仅作为读取和指引的“索引层”。
- **强匹配原则**：文件名必须包含 IOC 列表中的标准中文名或拉丁学名（IOC 15.1 列），否则将被系统忽略。
- **显示语言规则**：仅物种（Species）显示中文名；Order/Family/Genus 仅显示拉丁名。

## 3. 功能需求细化

### 3.1 权威数据库集成 (Data Engine)
- **内嵌索引库**：程序预载 `Multiling IOC 15.1_d.xlsx`，读取其中 `List` 工作表。
- **关键字段解析**：从 `List` 表中提取 `Order`、`Family`、`IOC_15.1`（拉丁名）、`Chinese`（中文名）；其余语言列忽略。
- **可更新性**：用户可以通过替换本地的 `Multiling IOC 15.1_d.xlsx` 文件来升级 IOC 版本，程序启动时自动重新解析并刷新分类树。

### 3.2 虚拟分类树构建 (Taxonomic Tree)
- **层级展示**：界面左侧自动生成四级树状结构：目 (Order) > 科 (Family) > 属 (Genus，根据拉丁名首词提取) > 种 (Species)。
- **物种节点显示**：节点名称格式为 中文名 拉丁名 (匹配张数)。
- **上层节点显示**：Order/Family/Genus 仅显示拉丁名。
- **过滤机制**：仅显示用户硬盘中存在对应照片的分类节点（可选）。

### 3.3 索引匹配算法 (Matching Logic)
- **双重匹配**：扫描文件名（不区分大小写），先检查是否包含 `IOC_15.1` 列中的字符串（如：Pycnonotus sinensis）；未命中时，再检查是否包含 `Chinese` 列中的字符串（如：白头鹎）。
- **单一命中**：按优先级命中后即归类，不考虑多重命中冲突。

### 3.4 “地址指引”功能 (The Indexer)
- **一键定位**：用户在软件内选中照片并点击“定位”按钮，系统立即调用资源管理器（Windows Explorer 或 macOS Finder），打开该图片所在的文件夹并高亮选中该文件。
- **只读预览**：支持双击调用系统默认看图工具查看图片，但不允许在软件内编辑或删除。

## 4. 界面布局草图 (UI Layout)

| 区域 | 功能描述 |
|------|----------|
| 顶部工具栏 | [设置根目录]、[更新IOC文件]、[全局搜索学名] |
| 左侧导航栏 | IOC 分类树：严谨的目/科/属/种层级 |
| 中央展示区 | 缩略图网格：展示当前分类下的所有照片卡片 |
| 侧边/底部栏 | 元数据面板：显示选中图片的物理路径、IOC 官方学名、多语言对照等 |

## 5. 业务流程 (User Flow)
1. **初始化**：用户选择存放照片的多个硬盘目录。
2. **自动匹配**：程序后台读取 Multiling IOC 列表，遍历所有文件名。
3. **结果聚合**：散落在“D:\2023\”、“E:\备份\”中的“白头鹎”照片全部出现在左侧树状结构的 鹎科 > 白头鹎 节点下。
4. **物理触达**：用户需要原图进行后期处理时，点击“定位”，直接跳转到硬盘真实位置。

## 6. 非功能性需求
- **性能要求**：针对 10 万张量级的照片，索引建立时间应控制在 1 分钟内（仅读取文件名）。
- **数据安全**：程序不具备任何写权限，绝对保证用户原始素材不被意外修改。
- **离线使用**：所有的匹配和展示逻辑均在本地完成，无需连接互联网。
- **索引持久化**：不需要持久化缓存，程序每次启动均进行全量扫描。

## 7. 文件扫描范围
- **文件类型**：仅扫描常见图片格式（如 JPG/JPEG/PNG/HEIC），不包含 RAW 文件（如 CR2/NEF/ARW 等）。
